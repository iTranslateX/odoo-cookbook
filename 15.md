å…¨ä¹¦å®Œæ•´ç›®å½•è¯·è§ï¼š[Odoo 14å¼€å‘è€…æŒ‡å—ï¼ˆCookbookï¼‰ç¬¬å››ç‰ˆ](README.md)

Odooçš„ç½‘é¡µå®¢æˆ·ç«¯æˆ–åå°ï¼Œæ˜¯å…¬å¸æˆå‘˜èŠ±è´¹æœ€å¤šæ—¶é—´çš„åœ°æ–¹ã€‚åœ¨[ç¬¬ä¹ç«  åç«¯è§†å›¾](9.md)ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨åå°ä¸­æ‰€å­˜åœ¨çš„åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ç»§æ‰¿å’Œè‡ªå®šä¹‰è¿™äº›åŠŸèƒ½ã€‚webæ¨¡å—åŒ…å«æœ‰å…³Odooç”¨æˆ·ç•Œé¢çš„æ‰€æœ‰å†…å®¹ã€‚

æœ¬ç« ä¸­çš„æ‰€æœ‰ä»£ç éƒ½ä¾èµ–äºwebæ¨¡å—ã€‚è¯»è€…å·²ç»çŸ¥é“Odooæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ˆä¼ä¸šç‰ˆå’Œç¤¾åŒºç‰ˆï¼‰ã€‚ç¤¾åŒºç‰ˆçš„ç”¨æˆ·ç•Œé¢ä½¿ç”¨webæ¨¡å—ï¼Œè€Œä¼ä¸šç‰ˆä½¿ç”¨ä¸€ä¸ªç»§æ‰¿ç¤¾åŒºç‰ˆwebæ¨¡å—çš„ç‰ˆæœ¬ï¼Œå³web_enterpriseæ¨¡å—ã€‚

ä¼ä¸šç‰ˆåœ¨ç¤¾åŒºç‰ˆwebæ¨¡å—çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›å…¶å®ƒåŠŸèƒ½ï¼Œå¦‚ç§»åŠ¨ç«¯å…¼å®¹ã€å¯æœç´¢èœå•ã€material designç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¤¾åŒºç‰ˆã€‚ä½†ä¸å¿…æ‹…å¿ƒï¼Œç¤¾åŒºç‰ˆä¸­æ‰€å¼€å‘çš„æ¨¡å—ä¸ä¼ä¸šç‰ˆå¯ä»¥å®Œç¾å…¼å®¹ï¼Œå› ä¸ºï¼Œåœ¨å†…éƒ¨web_enterpriseä¾èµ–äºç¤¾åŒºç‰ˆçš„webæ¨¡å—ï¼Œåªæ˜¯å¯¹å…¶æ·»åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚

> ğŸ“**é‡è¦ä¿¡æ¯**ï¼šOdoo 14ä¸æ­¤å‰çš„Odooç‰ˆæœ¬åœ¨ç½‘é¡µå®¢æˆ·ç«¯ä¸Šæœ‰äº›ç‰¹åˆ«ä¹‹å¤„ã€‚å®ƒåŒ…å«äº†ä¸¤å¥—æ¡†æ¶ç”¨äºç»´æŠ¤Odooåå°çš„å›¾å½¢ç•Œé¢ã€‚ç¬¬ä¸€ç§æ˜¯ä¼ ç»Ÿçš„åŸºäºå¾®ä»¶ï¼ˆå°éƒ¨ä»¶ï¼‰çš„æ¡†æ¶ï¼Œç¬¬äºŒç§æ˜¯åŸºäºæ¨¡å—åŒ–çš„ç°ä»£æ¡†æ¶ï¼Œç§°ä¹‹åOdooç½‘é¡µåº“(OWL)ã€‚OWLæ˜¯åœ¨Odoo v14ä¸­æ–°å¼•å…¥çš„UIæ¡†æ¶ã€‚ä¸¤è€…éƒ½ä½¿ç”¨QWebæ¨¡å—ä½œä¸ºç»“æ„ï¼Œä½†åœ¨è¯­æ³•åŠæ¡†æ¶è¿è¡Œæ–¹å¼ä¸Šåšå‡ºäº†å¾ˆå¤§çš„æ”¹å˜ã€‚
>
> è™½ç„¶Odoo 14ä½¿ç”¨äº†æ–°æ¡†æ¶OWLï¼Œä½†Odooå¹¶æ²¡æœ‰åœ¨å¤„å¤„ä½¿ç”¨å®ƒã€‚å¤§å¤šæ•°ç½‘é¡µå®¢æˆ·ç«¯ä»ç„¶ä½¿ç”¨è€çš„åŸºäºå¾®ä»¶çš„æ¡†æ¶ã€‚æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è‡ªå®šä¹‰åŸºäºå¾®ä»¶æ¡†æ¶çš„ç½‘é¡µå®¢æˆ·ç«¯ã€‚ä¸‹ä¸€ç« ä¸­æˆ‘ä»¬ä¼šå­¦ä¹ OWLæ¡†æ¶ã€‚

æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºæ–°å­—æ®µå¾®ä»¶æ¥è·å–ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬è¿˜å°†ä»é›¶å¼€å§‹æ–°å»ºè§†å›¾ã€‚åœ¨é˜…è¯»å®Œæœ¬ç« åï¼Œè¯»è€…å°†èƒ½å¤Ÿåœ¨Odooåå°ä¸­åˆ›å»ºè‡ªå·±çš„UIå…ƒç´ ã€‚

> ğŸ“**æ³¨ï¼š**Odoo çš„ç”¨æˆ·ç•Œé¢é‡åº¦ä¾èµ–äºJavaScriptã€‚åœ¨æœ¬ç« ä¸­æˆ‘ä»¬ä¼šå‡å®šä½ å·²å…·å¤‡JavaScriptã€jQueryã€Underscore.jså’ŒSCSSçš„åŸºç¡€çŸ¥è¯†ã€‚

æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®²è§£å¦‚ä¸‹å°èŠ‚ï¼š

- åˆ›å»ºè‡ªå®šä¹‰å¾®ä»¶
- ä½¿ç”¨å®¢æˆ·ç«¯QWebæ¨¡æ¿
- å‘æœåŠ¡ç«¯åšRPCè°ƒç”¨
- æ–°å»ºä¸€ä¸ªè§†å›¾
- è°ƒè¯•å®¢æˆ·ç«¯ä»£ç 
- é€šè¿‡å¼•å¯¼æå‡ç”¨æˆ·ä¸Šæ‰‹ä½“éªŒ
- ç§»åŠ¨åº”ç”¨JavaScript

## æŠ€æœ¯å‡†å¤‡

å­¦ä¹ æœ¬ç« è¦æ±‚å·²ç»æœ‰ä¸€ä¸ªOdooåœ¨çº¿å¹³å°ã€‚

æœ¬ç« ä¸­çš„æ‰€æœ‰ä»£ç å¯é€šè¿‡[GitHubä»“åº“](https://github.com/alanhou/odoo14-cookbook/tree/main/Chapter15)è¿›è¡Œä¸‹è½½ã€‚

## åˆ›å»ºè‡ªå®šä¹‰å¾®ä»¶

åœ¨[ç¬¬ä¹ç«  åç«¯è§†å›¾](9.md)ä¸­å·²ç»å­¦åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾®ä»¶æ¥ä»¥ä¸åŒæ ¼å¼å±•ç¤ºæŸäº›æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†widget='image'å°†äºŒè¿›åˆ¶å­—æ®µå±•ç¤ºä¸ºå›¾ç‰‡ã€‚è¦æ¼”ç¤ºå¦‚ä½•åˆ›å»ºè‡ªå·±çš„å¾®ä»¶ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç”¨æˆ·å¯ä»¥é€‰æ‹©æ•´å‹å­—æ®µçš„å¾®ä»¶ï¼Œä½†æˆ‘ä»¬å°†é‡‡ç”¨ä¸åŒçš„å±•ç°æ–¹å¼ã€‚ä½¿ç”¨çš„ä¸æ˜¯è¾“å…¥æ¡†ï¼Œè€Œæ˜¯å±•ç¤ºä¸ºé¢œè‰²æ‹¾å–å™¨ï¼Œè¿™æ ·æˆ‘ä»¬æˆ‘ä»¬å¯ä»¥é€‰æ‹©é¢œè‰²æ•°å€¼ã€‚è¿™é‡Œçš„æ•°å€¼ä¸ç›¸å…³çš„é¢œè‰²å­˜åœ¨æ˜ å°„å…³ç³»ã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä½¿ç”¨å¸¦æœ‰åŸºç¡€å­—æ®µå’Œè§†å›¾çš„my_libraryæ¨¡å—ã€‚åœ¨GitHubä»“åº“çš„**Chapter15/00_initial_module**ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°è¿™ä¸€åŸºç¡€my_libraryæ¨¡å—ã€‚

### å¦‚ä½•å®ç°...

æˆ‘ä»¬å°†æ·»åŠ åŒ…å«å¾®ä»¶é€»è¾‘çš„JavaScriptæ–‡ä»¶ï¼Œä»¥åŠè´Ÿè´£æ ·å¼çš„SCSSæ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨å›¾ä¹¦è¡¨å•ä¸­æ·»åŠ ä¸€ä¸ªæ•´å‹å­—æ®µæ¥ä½¿ç”¨æ–°å¾®ä»¶ã€‚æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥æ–°å¢ä¸€ä¸ªå­—æ®µå¾®ä»¶ï¼š

1. æ·»åŠ ä¸€ä¸ªstatic/src/js/field_widget.jsæ–‡ä»¶ã€‚æ­¤å¤„æ‰€ä½¿ç”¨çš„è¯­æ³•å¯å‚è§

   ç¬¬åå››ç«  CMSç½‘ç«™å¼€å‘

   ä¸­

   ä¸ºç½‘ç«™æ‰©å±•CSSå’ŒJavaScript

   ä¸€èŠ‚ï¼š

   ```
   odoo.define('my_field_widget', function (require) {
     "use strict";
     var AbstractField = require('web.AbstractField');
     var fieldRegistry = require('web.field_registry');
   ```

2. é€šè¿‡ç»§æ‰¿AbstractFieldæ¥åˆ›å»ºå¾®ä»¶ï¼š

   ```
   var colorField = AbstractField.extend({
   ```

3. è®¾ç½®CSSç±»ã€æ ¹å…ƒç´ æ ‡ç­¾ä»¥åŠå¾®ä»¶æ‰€æ”¯æŒçš„å­—æ®µç±»å‹ï¼š

   ```
   className: 'o_int_colorpicker',
   tagName: 'span',
   supportedFieldTypes: ['integer'],
   ```

4. æ•è·æŸäº›JavaScriptäº‹ä»¶ï¼š

   ```
   events: {
     'click .o_color_pill': 'clickPill',
   },
   ```

5. é‡è½½initè¿›è¡Œåˆå§‹åŒ–ï¼š

   ```
   init: function () {
     this.totalColors = 10;
     this._super.apply(this, arguments);
   },
   ```

6. é‡è½½_renderEditå’Œ_renderReadonlyæ¥è®¾ç½®DOMå…ƒç´ ï¼š

   ```
   _renderEdit: function () {
     this.$el.empty();
     for (var i = 0; i < this.totalColors; i++ ) {
       var className = "o_color_pill o_color_" + i;
         if (this.value === i ) {
           className += ' active';
         }
       this.$el.append($('<span>', {
         'class': className,
         'data-val': i,
       }));
     }
    },
    _renderReadonly: function () {
     var className = "o_color_pill active readonly o_color_" + this.value;
     this.$el.append($('<span>', {
       'class': className,
     }));
    },
   ```

7. å®šä¹‰æˆ‘ä»¬åœ¨å‰é¢æ‰€ä½¿ç”¨çš„handlerï¼š

   ```
     clickPill: function (ev) {
       var $target = $(ev.currentTarget);
       var data = $target.data();
       this._setValue(data.val.toString());
     }
   }); // closing AbstractField
   ```

8. åˆ«å¿˜äº†æ³¨å†Œè¯¥å¾®ä»¶ï¼š

   ```
   fieldRegistry.add('int_color', colorField);
   ```

9. è®©å…¶åœ¨å…¶å®ƒæ’ä»¶ä¸­å¯ä½¿ç”¨ç”¨ï¼š

   ```
     return {
     colorField: colorField,
     };
   }); // closing 'my_field_widget' namespace
   ```

10. åœ¨static/src/scss/field_widget.scssä¸­æ·»åŠ ä¸€äº›SCSSï¼š

    ```
    .o_int_colorpicker {
      .o_color_pill {
        display: inline-block;
        height: 25px;
        width: 25px;
        margin: 4px;
        border-radius: 25px;
        position: relative;
        @for $size from 1 through length($o-colors) {
          &.o_color_#{$size - 1} {
            background-color: nth($o-colors, $size);
            &:not(.readonly):hover {
              transform: scale(1.2);
              transition: 0.3s;
              cursor: pointer;
            }
            &.active:after{
              content: "\f00c";
              display: inline-block;
              font: normal normal normal 14px/1 FontAwesome;
              font-size: inherit;
              color: #fff;
              position: absolute;
              padding: 4px;
              font-size: 16px;
            }
          }
        }
      }
    }
    ```

11. åœ¨views/templates.xmlåå°èµ„æºä¸­æ³¨å†Œè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <odoo>
      <template id="assets_end" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
          <script src="/my_field_widget/static/src/js/field_widget.js" type="text/javascript" />
          <link href="/my_field_widget/static/src/scss/field_widget.scss" rel="stylesheet" type="text/scss" />
        </xpath>
      </template>
    </odoo>
    ```

12. æœ€ååœ¨library.bookæ¨¡å‹ä¸­æ·»åŠ é¢œè‰²æ•´å‹å­—æ®µï¼š

    ```
    color = fields.Integer()
    ```

13. åœ¨å›¾ä¹¦è¡¨å•è§†å›¾ä¸­æ·»åŠ é¢œè‰²å­—æ®µï¼ŒåŒæ—¶æ·»åŠ widget="int_color"ï¼š

    ```
    ...
    <group>
      <field name="date_release"/>
      <field name="color" widget="int_color"/>
    </group>
    ...
    ```

æ›´æ–°æ¨¡å—åº”ç”¨ä¿®æ”¹ã€‚åœ¨æ›´æ–°å®Œæˆåï¼Œæ‰“å¼€å›¾ä¹¦è¡¨å•è§†å›¾ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸‹å›¾ä¸­æ‰€ç¤ºçš„é¢œè‰²æ‹¾å–å™¨ï¼š

![å›¾15.1 â€“ å¦‚ä½•æ˜¾ç¤ºè‡ªå®šä¹‰å¾®ä»¶](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021052902105571.png)

å›¾15.1 â€“ å¦‚ä½•æ˜¾ç¤ºè‡ªå®šä¹‰å¾®ä»¶

### å®ç°åŸç†...

ä¸ºä¾¿äºè¯»è€…æŒæ¡ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ¥é€šè¿‡æŸ¥çœ‹ç»„ä»¶æ¥äº†è§£å¾®ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼š

- init()ï¼šè¿™æ˜¯å¾®ä»¶æ„é€ å‡½æ•°ã€‚ç”¨äºè¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨åˆå§‹åŒ–å¾®ä»¶æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¯¥æ–¹æ³•ã€‚
- willStart()ï¼šè¿™ä¸ªæ–¹æ³•åœ¨å¾®ä»¶åˆå§‹åŒ–ä»¥åŠåœ¨DOMä¸­æ·»åŠ å…ƒç´ çš„è¿‡ç¨‹ä¸­è°ƒç”¨ã€‚å®ƒç”¨äºåˆå§‹åŒ–å¼‚æ­¥æ•°æ®åˆ°å¾®ä»¶ä¸­ã€‚å®ƒè¿˜ä¼šè¿”å›ä¸€ä¸ªå»¶è¿Ÿå¯¹è±¡ï¼Œåªéœ€è¦é€šè¿‡super()æ–¹æ³•è°ƒç”¨å³å¯è·å–ã€‚æˆ‘ä»¬åœ¨åé¢çš„å°èŠ‚ä¸­ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚
- start()ï¼šè¯¥æ–¹æ³•åœ¨å®Œæˆå¾®ä»¶æ¸²æŸ“ä¸”å°šæœªæ·»åŠ åˆ°DOMä¸­æ—¶è°ƒç”¨ã€‚è¿™éå¸¸æœ‰åŠ©äºæ¸²æŸ“åä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ªå»¶è¿Ÿå¯¹è±¡ã€‚å¯ä»¥åœ¨this.$elä¸­è®¿é—®å·²æ¸²æŸ“çš„å…ƒç´ ã€‚
- destroy()ï¼šè¯¥æ–¹æ³•åœ¨å¾®ä»¶é”€æ¯æ—¶è°ƒç”¨ã€‚å¤šç”¨äºåŸºæœ¬çš„æ¸…ç†æ“ä½œï¼Œå¦‚å–æ¶ˆäº‹ä»¶ç»‘å®šã€‚

> **ğŸ“å°è´´å£«ï¼šå¾®**ä»¶çš„åŸºæœ¬ base ç±»æ˜¯Widgetï¼ˆåœ¨web.Widgetä¸­å®šä¹‰ï¼‰ã€‚å¦‚æœæƒ³è¦åšæ›´æ·±å…¥çš„å­¦ä¹ ï¼Œå¯ä»¥é€šè¿‡/addons/web/static/src/js/core/widget.jsè¿›è¡Œç ”ç©¶ã€‚

ç¬¬1æ­¥ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†AbstractFieldå’ŒfieldRegistryã€‚

ç¬¬2æ­¥ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»§æ‰¿AbstractFieldåˆ›å»ºäº†colorFieldã€‚è¿™æ ·æˆ‘ä»¬çš„colorFieldå°±ä¼šè·å–åˆ°AbstractFieldçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚

ç¬¬3æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†3ä¸ªå±æ€§ï¼šclassNameç”¨äºå®šä¹‰å¾®ä»¶æ ¹å…ƒç´ çš„ç±»ï¼ŒtagNameç”¨ä½œæ ¹å…ƒç´ çš„ç±»å‹ï¼ŒsupportedFieldTypesç”¨äºå†³å®šè¯¥å¾®ä»¶æ‰€æ”¯æŒçš„å­—æ®µç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªé’ˆå¯¹æ•´å‹å­—æ®µçš„å¾®ä»¶ã€‚

ç¬¬4æ­¥ä¸­ï¼Œæˆ‘ä»¬å¯¹å¾®ä»¶çš„äº‹ä»¶è¿›è¡Œäº†æ˜ å°„ã€‚é€šå¸¸é”®ä¸ºäº‹ä»¶åå’Œå¯é€‰CSSé€‰æ‹©å™¨çš„ç»„åˆã€‚äº‹ä»¶å’ŒCSSé€‰æ‹©å™¨ç”±ç©ºæ ¼åˆ†å‰²ï¼Œå€¼ä¸ºå¾®ä»¶ä¸­æ–¹æ³•çš„åç§°ã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡Œäº‹ä»¶æ—¶ï¼ŒæŒ‡å®šçš„æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»é¢œè‰²å—æ—¶ï¼Œæˆ‘ä»¬è¦åœ¨å­—æ®µä¸­è®¾ç½®ä¸€ä¸ªæ•´å‹å€¼ã€‚ä¸ºç®¡ç†ç‚¹å‡»äº‹ä»¶ï¼Œæˆ‘ä»¬åœ¨**events**é”®ä¸­æ·»åŠ äº†ä¸€ä¸ªCSSé€‰æ‹©å™¨å’Œæ–¹æ³•ã€‚

ç¬¬5æ­¥ä¸­ï¼Œæˆ‘ä»¬é‡è½½äº†initæ–¹æ³•å¹¶è®¾ç½®äº†totalColorså±æ€§çš„å€¼ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¯¥å˜é‡æ¥å†³å®šé¢œè‰²å—çš„å€¼ã€‚è¿™é‡Œéœ€è¦æ˜¾ç¤º10ä¸ªé¢œè‰²å—ï¼Œå› æ­¤å°†å€¼è®¾ä¸ºäº†10.

ç¬¬6æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•ï¼š_renderEditå’Œ_renderReadonlyã€‚æ ¹æ®åç§°å¯ä»¥çŸ¥é“ï¼Œ_renderEditåœ¨å¾®ä»¶å¤„äºç¼–è¾‘æ¨¡å¼æ—¶è°ƒç”¨ï¼Œè€Œ_renderReadonlyåœ¨å¾®ä»¶å¤„äºåªè¯»æ¨¡å¼æ—¶è°ƒç”¨ã€‚åœ¨ç¼–è¾‘æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€äº›<span>æ ‡ç­¾ï¼Œæ¯ä¸ªéƒ½åœ¨å¾®ä»¶ä¸­è¡¨ç¤ºä¸€ç§é¢œè‰²ã€‚åœ¨ç‚¹å‡»<span>æ ‡ç­¾æ—¶ï¼Œä¼šåœ¨å­—æ®µä¸­è®¾ç½®å€¼ã€‚æˆ‘ä»¬å°†å®ƒä»¬æ·»åŠ åˆ°äº†this.$elä¸­ã€‚è¿™é‡Œçš„$elæ˜¯å¾®ä»¶çš„æ ¹å…ƒç´ ï¼Œå®ƒä¼šåœ¨è¡¨å•è§†å›¾ä¸­è¿›è¡Œæ·»åŠ ã€‚åœ¨åªè¯»æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ä»…éœ€å±•ç¤ºé€‰ä¸­çš„é¢œè‰²ï¼Œå› æ­¤é€šè¿‡_renderReadonly()æ–¹æ³•æ·»åŠ äº†å•ä¸ªé¢œè‰²å—ã€‚å°±ç›®å‰è€Œè¨€ï¼Œæˆ‘ä»¬ä»¥ç¡¬ç¼–ç çš„æ–¹å¼æ·»åŠ äº†è‰²å—ï¼Œä½†åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨JavaScript Qwebæ¨¡æ¿æ¥æ¸²æŸ“è¿™äº›è‰²å—ã€‚æ³¨æ„åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†totalColorså±æ€§ï¼Œå®ƒé€šè¿‡init()è¿›è¡Œçš„è®¾ç½®ã€‚

ç¬¬7æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†clickPillå¤„ç†æ–¹æ³•æ¥ç®¡ç†è‰²å—çš„ç‚¹å‡»ã€‚ä½¿ç”¨äº†_setValueæ–¹æ³•æ¥è®¾ç½®å­—æ®µå€¼ã€‚è¯¥æ–¹æ³•é€šè¿‡AbstractFieldç±»æ·»åŠ ã€‚åœ¨è®¾ç½®å­—æ®µå€¼æ—¶ï¼ŒOdooæ¡†æ¶ä¼šé‡æ–°æ¸²æŸ“å¾®ä»¶å¹¶å†æ¬¡è°ƒç”¨_renderEditæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ›´æ–°åçš„å€¼æ¥æ¸²æŸ“å¾®ä»¶äº†ã€‚

ç¬¬8æ­¥ä¸­ï¼Œåœ¨å®šä¹‰äº†æ–°å¾®ä»¶ä¹‹åï¼Œé€šè¿‡web.field_registryä¸­çš„è¡¨å•æ³¨å†Œè¡¨æ¥è¿›è¡Œæ³¨å†Œéå¸¸ä¹‹å…³é”®ã€‚æ³¨æ„æ‰€æœ‰çš„è§†å›¾ç±»å‹éƒ½æŸ¥æ‰¾è¿™ä¸ªæ³¨å†Œè¡¨ï¼Œå› æ­¤å¦‚æœå¸Œæœ›åœ¨åˆ—è¡¨è§†å›¾ä¸­åˆ›å»ºå¦ä¸€ç§å±•ç°å­—æ®µçš„å½¢å¼ï¼Œä¹Ÿéœ€è¦åœ¨è¿™é‡Œæ·»åŠ å¾®ä»¶å¹¶åœ¨è§†å›¾å®šä¹‰ä¸­å¯¹è¯¥å­—æ®µè®¾ç½®å¾®ä»¶å±æ€§ã€‚

æœ€åï¼Œæˆ‘ä»¬å¯¼å‡ºäº†å¾®ä»¶ç±»ï¼Œè¿™æ ·å…¶å®ƒçš„æ’ä»¶å¯ä»¥å¯¹å…¶è¿›è¡Œæ‰©å±•å’Œç»§æ‰¿ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨library.bookæ¨¡å‹ä¸­æ–°å¢äº†æ•´å‹å­—æ®µcolorã€‚æˆ‘ä»¬è¿˜é€šè¿‡widget="int_color"å±æ€§åœ¨è¡¨å•è§†å›¾ä¸­æ·»åŠ äº†è¯¥å­—æ®µã€‚è¿™ä¼šåœ¨è¡¨å•è§†å›¾ä¸­å±•ç¤ºæˆ‘ä»¬çš„å¾®ä»¶ï¼Œç”¨äºä»£æ›¿é»˜è®¤çš„æ•´å‹ç»„ä»¶ã€‚

### æ‰©å±•çŸ¥è¯†...

web.mixinså‘½åç©ºé—´å®šä¹‰äº†å‡ ä¸ªmixinå¸®åŠ©ç±»ï¼Œåœ¨å¼€å‘è¡¨å•å¾®ä»¶æ—¶åˆ«å¿˜è®°ä½¿ç”¨ã€‚AbstractFieldé€šè¿‡ç»§æ‰¿Widgetç±»æ¥åˆ›å»ºï¼Œè€ŒWidgetç±»ç»§æ‰¿äº†ä¸¤ä¸ªmixinã€‚ç¬¬ä¸€ä¸ªä¸ºEventDispatcherMixinï¼Œå®ƒæä¾›æ·»åŠ å¹¶è§¦å‘äº‹ä»¶handlerçš„ç®€å•æ¥å£ã€‚ç¬¬äºŒä¸ªæ˜¯ServicesMixinï¼Œæä¾›RPCè°ƒç”¨å’ŒåŠ¨ä½œçš„å‡½æ•°ã€‚

> ğŸ“**é‡è¦è´´å£«**ï¼šæƒ³è¦é‡è½½ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œåº”å…ˆç ”ç©¶å…¶åŸºç±»äº†è§£å®ƒæ‰€è¿”å›çš„å‡½æ•°ã€‚å¸¸è§é”™è¯¯æ˜¯å¿˜è®°è¿”å›è¶…çº§ç”¨æˆ·çš„å»¶è¿Ÿå¯¹è±¡ï¼Œè¿™ä¼šå¯¼è‡´å¼‚æ­¥æ“ä½œæ—¶å‡ºç°é—®é¢˜ã€‚

å¾®ä»¶éœ€è¦è´Ÿè´£éªŒè¯ã€‚ä½¿ç”¨isValidå‡½æ•°å®ç°è¿™ç§è‡ªå®šä¹‰éªŒè¯ã€‚

## ä½¿ç”¨å®¢æˆ·ç«¯QWebæ¨¡æ¿

å°±åƒåœ¨JavaScriptä¸­åˆ›å»ºHTMLä»£ç æ˜¯ä¸€ç§ä¸å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ä¸€æ ·ï¼Œæˆ‘ä»¬åº”åœ¨å®¢æˆ·ç«¯JavaScriptä»£ç ä¸­åˆ›å»ºå°½é‡å°‘çš„DOMå…ƒç´ ã€‚å¹¸å¥½åœ¨å®¢æˆ·ç«¯ä¹Ÿæœ‰ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œæ›´å¹¸è¿çš„æ˜¯ï¼Œå®¢æˆ·ç«¯çš„æ¨¡æ¿å¼•æ“å’ŒæœåŠ¡ç«¯æ¨¡æ¿è¯­æ³•ç›¸åŒã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰ä¸€å°èŠ‚ä¸­çš„my_libraryæ¨¡å—ã€‚æˆ‘ä»¬å°†é€šè¿‡æŠŠDOMå…ƒç´ åˆ›å»ºè¿ç§»åˆ°QWebæ¥è®©å…¶æ›´åŠ çš„æ¨¡å—åŒ–ã€‚

### å¦‚ä½•å®ç°...

æˆ‘ä»¬éœ€è¦åœ¨å£°æ˜æ–‡ä»¶ä¸­æ·»åŠ QWebå®šä¹‰å¹¶ä¿®æ”¹JavaScriptä»£ç æ¥è¿›è¡Œä½¿ç”¨ã€‚æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥è¿›è¡Œæ“ä½œï¼š

1. å¯¼å…¥web.coreå¹¶å°†å¯¹qwebçš„å¼•ç”¨æå–ä¸ºä¸€ä¸ªå˜é‡ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š

   ```
   odoo.define('my_field_widget', function (require) {
     "use strict";
   
     var AbstractField = require('web.AbstractField');
     var fieldRegistry = require('web.field_registry');
   
     var core = require('web.core');
     var qweb = core.qweb;
     ...
   ```

2. ä¿®æ”¹_renderEditå‡½æ•°æ¥æ¸²æŸ“è¯¥å…ƒç´ ï¼ˆç»§æ‰¿è‡ª

   widget

   ï¼‰ï¼š

   ```
   _renderEdit: function () {
     this.$el.empty();
     var pills = qweb.render('FieldColorPills', {widget: this});
     this.$el.append(pills);
   },
   ```

3. æ·»åŠ æ¨¡æ¿æ–‡ä»¶static/src/xml/qweb_template.xmlï¼š

   ```
   <?xml version="1.0" encoding="UTF-8"?>
   <templates>
     <t t-name="FieldColorPills">
       <t t-foreach="widget.totalColors" t-as='pill_no'>
         <span t-attf-class="o_color_pill o_color_#{pill_no}
           #{widget.value === pill_no and 'active' or ''}"
           t-att-data-val="pill_no"/>
       </t>
     </t>
   </templates>
   ```

4. åœ¨å£°æ˜æ–‡ä»¶ä¸­æ³¨å†ŒQWebæ–‡ä»¶ï¼š

   ```
   "qweb": [
     'static/src/xml/qweb_template.xml',
   ],
   ```

ç°åœ¨ï¼Œå…¶å®ƒæ’ä»¶ä¿®æ”¹å¾®ä»¶æ‰€ä½¿ç”¨çš„HTMLä»£ç æ›´ä¸ºå®¹æ˜“äº†ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥é€šè¿‡QWebæ¨¡å¼æ¥è¿›è¡Œé‡å†™ã€‚

### å®ç°åŸç†...

å› ä¸ºåœ¨[ç¬¬åå››ç«  CMSç½‘ç«™å¼€å‘](14.md)*åˆ›å»ºæˆ–æ›´æ”¹æ¨¡æ¿ - QWeb*ä¸€èŠ‚ä¸­å·²æœ‰å¯¹QWebåŸºç¡€çŸ¥è¯†éå¸¸å…¨é¢çš„è®¨è®ºï¼Œè¿™é‡Œä¼šé›†ä¸­è®²è§£å­˜åœ¨ä¸åŒçš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œéœ€è¦æ³¨æ„åˆ°æˆ‘ä»¬å¤„ç†çš„æ˜¯JavaScript QWebçš„å®ç°ï¼Œè€Œä¸æ˜¯æœåŠ¡ç«¯ä¸­çš„Pythonå®ç°ã€‚å°±æ˜¯è¯´æˆ‘ä»¬æ²¡æœ‰è¯»å–è®°å½•æˆ–ç¯å¢ƒçš„æƒé™ï¼Œä»…èƒ½è®¿é—®qweb.renderå‡½æ•°ä¸­æ‰€ä¼ é€’çš„å‚æ•°ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡**widget**é”®ä¼ é€’äº†å½“å‰å¯¹è±¡ã€‚è¿™è¡¨ç¤ºåº”å°†æ‰€æœ‰çš„é€»è¾‘æ”¾åœ¨å¾®ä»¶çš„JavaScriptä»£ç ä¸­ï¼Œåªè®©æ¨¡æ¿è®¿é—®å±æ€§æˆ–å¯èƒ½ç”¨åˆ°çš„å‡½æ•°ã€‚æ—¢ç„¶æˆ‘ä»¬èƒ½è®¿é—®å¾®ä»¶ä¸­æ‰€æœ‰å¯ç”¨çš„å±æ€§ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹totalColorså±æ€§æ¥å¯¹æ¨¡æ¿ä¸­çš„å€¼è¿›è¡Œæ£€æµ‹ã€‚

å®¢æˆ·ç«¯QWebå’ŒQWebè§†å›¾é—´å¹¶æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥å­˜åœ¨ä¸åŒçš„æœºåˆ¶æ¥è®©ç½‘é¡µå®¢æˆ·ç«¯è¯†åˆ«æ¨¡æ¿ - é€šè¿‡qwebé”®ä»¥ç›¸å¯¹æ’ä»¶æ ¹è·¯å¾„çš„æ–‡ä»¶ååˆ—è¡¨å°†å®ƒä»¬æ·»åŠ åˆ°æ’ä»¶çš„å£°æ˜ä¸­ã€‚

> ğŸ“**æ³¨**ï¼šå¦‚æœä¸å¸Œæœ›åœ¨å£°æ˜æ–‡ä»¶ä¸­åˆ—å‡ºQWebæ¨¡æ¿ï¼Œå¯ä»¥å¯¹å°ç»„ä»¶ä½¿ç”¨**xmlDependencies**é”®æ¥æ‡’åŠ è½½æ¨¡æ¿ã€‚ä½¿ç”¨**xmlDependencies**ï¼ŒQWebä»…åœ¨å¾®ä»¶åˆå§‹åŒ–æ—¶è¿›è¡ŒåŠ è½½ã€‚

### æ‰©å±•çŸ¥è¯†...

è¿™é‡Œä½¿ç”¨QWebçš„åŸå› æ˜¯å…¶å¯æ‰©å±•æ€§ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯QWebä¹‹é—´çš„å¦ä¸€ä¸ªå¤§åŒºåˆ«ã€‚åœ¨å®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨XPathè¡¨è¾¾å¼ï¼Œéœ€è¦ä½¿ç”¨jQueryé€‰æ‹©å™¨å’Œæ“ä½œã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦åœ¨å¦ä¸€ä¸ªæ¨¡å—çš„å¾®ä»¶ä¸­æ·»åŠ ç”¨æˆ·å›¾æ ‡ï¼Œéœ€è¦åœ¨æ¯ä¸ªè‰²å—ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç æ¥è·å–å›¾æ ‡ï¼š

```
<t t-extend=â€œFieldColorPillsâ€>
  <t t-jquery=â€œspanâ€ t-operation=â€œprependâ€>
    <i class=â€œfa fa-userâ€ />
  </t>
</t>
```

å¦‚æœåœ¨è¿™é‡ŒåŒæ—¶ç»™å®šä¸€ä¸ªt-name å±æ€§çš„è¯ï¼Œä¼šäº§ç”ŸåŸæ¨¡æ¿çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸ä¼šåŠ¨åˆ°åŸæ¨¡æ¿ã€‚ t-operationå±æ€§çš„å…¶å®ƒå¯ç”¨å€¼æœ‰append, before, after, innerå’Œreplaceï¼Œä¼šè®©tå…ƒç´ çš„å†…å®¹è¦ä¹ˆé€šè¿‡appendå°†å…¶æ·»åŠ åˆ°åŒ¹é…å†…å®¹ä¹‹åï¼Œè¦ä¹ˆé€šè¿‡beforeæˆ–afterå°†å…¶æ”¾åˆ°åŒ¹é…å…ƒç´ ä¹‹å‰æˆ–ä¹‹åï¼Œè¦ä¹ˆé€šè¿‡innerå°†å…¶æ›¿æ¢æ‰€åŒ¹é…çš„å…ƒç´ å†…å®¹ï¼Œåˆæˆ–è€…é€šè¿‡replaceæ›¿æ¢æ‰æ•´ä¸ªå…ƒç´ ã€‚è¿˜æœ‰t-operation='attributes'ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥å¯¹åŒ¹é…çš„å…ƒç´ è®¾ç½®å±æ€§ï¼Œè§„åˆ™ ä¸æœåŠ¡ç«¯QWebç›¸åŒã€‚

å¦ä¸€ä¸ªä¸åŒæ˜¯å®¢æˆ·ç«¯QWebä¸­çš„åç§°ä¸ä¼šç”±æ¨¡å—åå»ºç«‹å‘½åç©ºé—´ï¼Œå› æ­¤éœ€è¦é€‰æ‹©æ¨¡æ¿çš„åç§°æ¥è®©å…¶åœ¨æ‰€å®‰è£…çš„æ‰€æœ‰æ’ä»¶æ¨¡å—ä¸­ä¿æŒå”¯ä¸€æ€§ï¼Œè¿™ä¹Ÿæ˜¯å¼€å‘è€…å¸¸å¸¸ä½¿ç”¨å¾ˆé•¿åç§°çš„åŸå› ã€‚

### å…¶å®ƒå†…å®¹

å¦‚æœæƒ³è¦å­¦ä¹ Qwebæ¨¡æ¿çš„æ›´å¤šå†…å®¹ï¼Œå¯å‚ç…§å¦‚ä¸‹å„ç‚¹ï¼š

- å®¢æˆ·ç«¯QWebå¼•æ“çš„é”™è¯¯æ¶ˆæ¯å’Œå¤„ç†è¾ƒOdooå…¶å®ƒéƒ¨åˆ†æ¥å¾—æ›´ä¸ºä¸æ–¹ä¾¿ã€‚å°é”™è¯¯å¸¸å¸¸å¹¶ä¸ä»£è¡¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè®©åˆå­¦è€…å¾ˆéš¾å¾€ä¸‹ä½¿ç”¨ã€‚
- å¹¸è€Œï¼Œæœ¬ç« ç¨åçš„*è°ƒè¯•å®¢æˆ·ç«¯ä»£ç *ä¸€èŠ‚ä¸­ä¼šè®²è§£å®¢æˆ·ç«¯QWebæ¨¡æ¿çš„ä¸€äº›è°ƒè¯•è¯­å¥ã€‚

## å‘æœåŠ¡ç«¯åšRPCè°ƒç”¨

è¿Ÿæ—©ä½ çš„å¾®ä»¶ä¼šéœ€è¦ä»æœåŠ¡ç«¯æŸ¥æ‰¾ä¸€äº›æ•°æ®ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºé¢œè‰²å—æ·»åŠ ä¸€æ¡æç¤ºä¿¡æ¯ã€‚åœ¨ç”¨æˆ·å°†å…‰æ ‡æ‚¬åœåœ¨é¢œè‰²å—å…ƒç´ ä¹‹ä¸Šæ—¶ï¼Œæç¤ºæ¡†ä¸­ä¼šæ˜¾ç¤ºä¸è¯¥é¢œè‰²å…³è”çš„å›¾ä¹¦çš„æ•°é‡ã€‚æˆ‘ä»¬å°†ä¼šå¯¹æœåŠ¡ç«¯åšä¸€ä¸ªRPCè°ƒç”¨æ¥è·å–æŒ‡å®šé¢œè‰²å…³è”æ•°æ®çš„å›¾ä¹¦æ•°é‡ã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬èŠ‚æˆ‘ä»¬ä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­çš„my_libraryæ¨¡å—ã€‚

### å¦‚ä½•å®ç°...

æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤æ¥å¯¹æœåŠ¡ç«¯åšRPCè°ƒç”¨å¹¶åœ¨æç¤ºæ¡†ä¸­æ˜¾ç¤ºç»“æœï¼š

1. æ·»åŠ willStartæ–¹æ³•å¹¶åœ¨RPCè°ƒç”¨ä¸­è®¾ç½®colorGroupDataï¼š

   ```
   willStart: function () {
     var self = this;
     this.colorGroupData = {};
       var colorDataDef = this._rpc({
       model: this.model,
       method: 'read_group',
       domain: [],
       fields: ['color'],
       groupBy: ['color'],
     }).then(function (result) {
       _.each(result, function (r) {
         self.colorGroupData[r.color] = r.color_count;
       });
     });
     return $.when(this._super.apply(this, arguments), colorDataDef);
    },
   ```

2. æ›´æ–°_renderEditå¹¶å¯¹é¢œè‰²å—è®¾ç½®åˆå§‹æç¤ºæ¡†ï¼š

   ```
   _renderEdit: function () {
     this.$el.empty();
     var pills = qweb.render('FieldColorPills', {widget: this});
     this.$el.append(pills);
     this.$el.find('[data-toggle="tooltip"]').tooltip();
   },
   ```

3. æ›´æ–°FieldColorPillsæ¨¡æ¿å¹¶æ·»åŠ æç¤ºæ•°æ®ï¼š

   ```
   <t t-name="FieldColorPills">
     <t t-foreach="widget.totalColors" t-as='pill_no'>
       <span t-attf-class="o_color_pill o_color_#{pill_no}
         #{widget.value === pill_no and 'active' or ''}"
         t-att-data-val="pill_no"
         data-toggle="tooltip"
         data-placement="top"
         t-attf-title="This color is used in #{widget.colorGroupData[pill_no] or 0 } books."
       />
     </t>
   </t>
   ```

æ›´æ–°æ¨¡å—æ¥åº”ç”¨ä¿®æ”¹ã€‚æ›´æ–°åï¼Œå°±å¯ä»¥åœ¨è‰²å—ä¸Šçœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æç¤ºä¿¡æ¯ï¼š

![å›¾15.2 â€“ ä½¿ç”¨RPCè·å–æç¤ºæ•°æ®](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021052907533939.png)

å›¾15.2 â€“ ä½¿ç”¨RPCè·å–æç¤ºæ•°æ®

### å®ç°åŸç†...

willStartå‡½æ•°åœ¨æ¸²æŸ“ä¹‹å‰è°ƒç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¿…é¡»åœ¨æ¸²æŸ“å¼€å§‹ä¹‹å‰è§£æçš„**Promise**å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨åƒæˆ‘ä»¬è¿™æ ·çš„ç”¨ä¾‹ä¸­ï¼Œéœ€è¦åœ¨æ¸²æŸ“ä¹‹å‰è¿è¡Œå¼‚æ­¥åŠ¨ä½œï¼Œè¿™æ‰æ˜¯è¯¥ä½¿ç”¨çš„å‡½æ•°ã€‚

åœ¨å¤„ç†æ•°æ®è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä¾èµ–äºå‰é¢è®²è§£çš„ServicesMixinç±»æ‰€æä¾›çš„_rpcå‡½æ•°ã€‚è¯¥å‡½æ•°å…è®¸æˆ‘ä»¬è°ƒç”¨æ¨¡å‹ä¸Šçš„ä»»æ„å…¬æœ‰å‡½æ•°ï¼Œå¦‚search, read, writeæˆ–æœ¬ä¾‹ä¸­çš„read_groupã€‚

ç¬¬1æ­¥ä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªRPCè°ƒç”¨å¹¶åœ¨å½“å‰æ¨¡å‹æœ¬ä¾‹ä¸­å³library.bookä¸Šè°ƒç”¨äº†read_groupæ–¹æ³•ã€‚æˆ‘ä»¬æ ¹æ®colorå­—æ®µè¿›è¡Œäº†åˆ†ç»„ï¼Œå› æ­¤RPCè°ƒç”¨ä¼šè¿”å›ç”±coloråˆ†ç»„çš„å›¾ä¹¦æ•°æ®å¹¶åœ¨color_counté”®ä¸­æ·»åŠ äº†ç´¯åŠ ã€‚æˆ‘ä»¬è¿˜åœ¨colorGroupDataä¸­å»ºç«‹äº†color_countä¸colorç´¢å¼•çš„æ˜ å°„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨QWebæ¨¡æ¿ä¸­ä½¿ç”¨äº†ã€‚åœ¨è¯¥å‡½æ•°çš„æœ€åä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬é€šè¿‡superæ¥è§£æäº†willStartå¹¶ä½¿ç”¨$.whenæ¥è¿›è¡ŒRPCè°ƒç”¨ã€‚å› æ­¤ï¼Œæ¸²æŸ“ä»…åœ¨è·å–åˆ°å€¼ä¹‹ååŠsuperæ‰€æ‰§è¡Œçš„ä»»æ„å¼‚æ­¥åŠ¨ä½œå®Œæˆä¹‹åå‘ç”Ÿã€‚

ç¬¬2æ­¥å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å†…å®¹ã€‚æˆ‘ä»¬åªæ˜¯åˆå§‹åŒ–äº†èµ·å§‹æç¤ºæ¡†ã€‚

ç¬¬3æ­¥ä¸­æˆ‘ä»¬ä½¿ç”¨äº†colorGroupDataè®¾ç½®æ‰€éœ€çš„å±æ€§æ¥æ˜¾ç¤ºæç¤ºæ¡†ã€‚åœ¨willStartæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡this.colorGroupDataæŒ‡å®šäº†coloræ˜ å°„ ï¼Œå› è€Œé€šè¿‡widget.colorGroupData.åœ¨QWebæ¨¡æ¿ä¸­å¯è¿›è¡Œè®¿é—®ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¼ é€’äº†å¾®ä»¶å¼•ç”¨ï¼Œè¿™å°±æ˜¯qweb.renderæ–¹æ³•ã€‚

> **ğŸ“æ³¨ï¼š**å¯ä»¥åœ¨å¾®ä»¶ä¸­çš„ä»»æ„åœ°æ–¹ä½¿ç”¨ç”¨_rpcã€‚æ³¨æ„è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ­£ç¡®åœ°ç®¡ç†å»¶æ—¶å¯¹è±¡æ¥è·å–æ‰€è¦çš„ç»“æœã€‚

### æ‰©å±•çŸ¥è¯†...

AbstractFieldç±»å¸¦æœ‰ä¸¤ä¸ªæœ‰è¶£çš„å±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ‘ä»¬åˆšåˆšä½¿ç”¨è¿‡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†this.modelå±æ€§ï¼Œå®ƒå­˜å‚¨äº†å½“å‰æ¨¡å‹çš„åç§°ï¼ˆå¦‚library.bookï¼‰ã€‚å¦ä¸€ä¸ªå±æ€§æ˜¯this.fieldï¼Œå¤§æ¦‚åŒ…å«å¾®ä»¶æ­£åœ¨æ˜¾ç¤ºå­—æ®µçš„æ¨¡å‹çš„fields_get()å‡½æ•°çš„è¾“å‡ºã€‚å®ƒä¼šç»™å‡ºæ‰€æœ‰ä¸å½“å‰å­—æ®µç›¸å…³è”çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºx2xå­—æ®µï¼Œfields_get()å‡½æ•°ä¼šç»™å‡ºco-modelæˆ–ä½œç”¨åŸŸçš„ä¿¡æ¯ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥æŸ¥è¯¢å­—æ®µçš„stringã€sizeæˆ–å…¶å¯åœ¨æ¨¡å‹å®šä¹‰æ—¶ä¸ºå­—æ®µæ‰€è®¾ç½®çš„å…¶å®ƒå±æ€§ã€‚

å¦ä¸€ä¸ªå¾ˆæœ‰å¸®åŠ©çš„å±æ€§æ˜¯nodeOptionsï¼Œå®ƒåŒ…å«é€šè¿‡<form>è§†å›¾å®šä¹‰çš„optionså±æ€§æ‰€ä¼ é€’çš„æ•°æ®ã€‚å®ƒå·²ç»è¿‡JSONè§£æï¼Œå› æ­¤å¯ä»¥åƒå…¶å®ƒå¯¹è±¡ä¸€æ ·è®¿é—®å®ƒã€‚äº†è§£æ›´å¤šæœ‰å…³è¿™äº›å±æ€§çš„çŸ¥è¯†ï¼Œå¯ä»¥è¿›ä¸€æ­¥æŒ–æ˜abstract_field.jsæ–‡ä»¶ã€‚

### å…¶å®ƒå†…å®¹

å¦‚æœåœ¨ç®¡ç†å¼‚æ­¥è¿ç®—æ—¶å‡ºç°é—®é¢˜å¯å‚ç…§å¦‚ä¸‹æ–‡æ¡£ï¼š

- Odooçš„RPCè¿”å›JavaScriptçš„åŸç”Ÿ**Promise**å¯¹è±¡ã€‚åœ¨è§£æå¥½**Promise**å¯¹è±¡ä¹‹åå°±å¯è·å–åˆ°æ‰€è¯·æ±‚æ•°æ®ã€‚æœ‰å…³**Promise**çš„æ›´å¤šçŸ¥è¯†è¯·å‚è§https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promiseã€‚

## æ–°å»ºä¸€ä¸ªè§†å›¾

æˆ‘ä»¬åœ¨[ç¬¬ä¹ç«  åç«¯è§†å›¾](9.md)ä¸­å­¦ä¹ åˆ°å­˜åœ¨ä¸åŒç±»å‹çš„è§†å›¾ï¼Œå¦‚è¡¨å•è§†å›¾ã€åˆ—è¡¨è§†å›¾ã€çœ‹æ¿è§†å›¾ç­‰ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„è§†å›¾ã€‚è¿™ä¸ªè§†å›¾ä¼šæ˜¾ç¤ºä½œè€…åˆ—è¡¨åŠä»–ä»¬æ‰€è‘—çš„å›¾ä¹¦ã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬èŠ‚ä¸­æˆ‘ä»¬ä½¿ç”¨å‰ä¸€å°èŠ‚çš„my_libraryæ¨¡å—ã€‚æ³¨æ„è§†å›¾æ˜¯éå¸¸å¤æ‚çš„ç»“æ„ï¼Œå¹¶ä¸”æ¯ç§å·²æœ‰è§†å›¾éƒ½æœ‰ä¸åŒçš„ç›®çš„å’Œå®ç°ã€‚æœ¬èŠ‚æ—¨åœ¨è®©è¯»è€…äº†è§£MVCæ¨¡å¼çš„è§†å›¾åŠå¦‚ä½•åˆ›å»ºç®€å•è§†å›¾ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸ºm2m_groupçš„è§†å›¾ï¼Œç›®çš„æ˜¯åœ¨ç»„ä¸­å±•ç¤ºè®°å½•ã€‚å°†è®°å½•åˆ†æˆä¸åŒç»„ï¼Œè§†å›¾å°†ä½¿ç”¨many2manyå­—æ®µæ•°æ®ã€‚åœ¨my_libraryæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬æœ‰author_idså­—æ®µã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®ä½œè€…åˆ†ç»„å›¾ä¹¦å¹¶åœ¨å¡ç‰‡ä¸­è¿›è¡Œæ˜¾ç¤ºã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å‘æ§åˆ¶é¢æ¿æ·»åŠ ä¸€ä¸ªæ–°æŒ‰é’®ã€‚å€ŸåŠ©äºè¿™ä¸ªæŒ‰é’®ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿæ–°å¢ä¸€æ¡å›¾ä¹¦è®°å½•ã€‚æˆ‘ä»¬è¿˜å°†åœ¨ä½œè€…çš„å¡ç‰‡ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™æ ·å¯ä»¥å°†ç”¨æˆ·é‡å®šå‘åˆ°å¦ä¸€ä¸ªè§†å›¾ä¸­ã€‚

### å¦‚ä½•å®ç°...

æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¥æ·»åŠ ä¸€ä¸ªåä¸ºm2m_groupæ–°è§†å›¾ï¼š

1. åœ¨ir.ui.viewä¸­æ·»åŠ ä¸€ä¸ªæ–°è§†å›¾ç±»å‹ï¼š

   ```
   class View(models.Model):
     _inherit = 'ir.ui.view'
     type = fields.Selection(selection_add=[('m2m_group', 'M2m Group')])
   ```

2. åœ¨ir.actions.act_window.viewä¸­æ–°å¢ä¸€ä¸ªè§†å›¾æ¨¡å¼ï¼š

   ```
   class ActWindowView(models.Model):
       _inherit = 'ir.actions.act_window.view'
   
       view_mode = fields.Selection(selection_add=[('m2m_group', 'M2m group')],
                                    ondelete={'m2m_group': 'cascade'})
   ```

3. é€šè¿‡ç»§æ‰¿baseæ¨¡å‹æ–°å¢æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé€šè¿‡JavaScriptæ¨¡å‹è°ƒç”¨ï¼ˆå‚è§ç¬¬4æ­¥äº†è§£æ›´å¤šè¯¦æƒ…ï¼‰:ï¼š

   ```
   class Base(models.AbstractModel):
     _inherit = 'base'
     
     @api.model
     def get_m2m_group_data(self, domain, m2m_field):
       records = self.search(domain)
       result_dict = {}
       for record in records:
         for m2m_record in record[m2m_field]:
           if m2m_record.id not in result_dict:
             result_dict[m2m_record.id] = {
               'name': m2m_record.display_name,
               'children': [],
               'model': m2m_record._name
             }
             result_dict[m2m_record.id]['children'].append({
               'name': record.display_name,
               'id': record.id,
             })
     return result_dict
   ```

4. æ–°å¢æ–‡ä»¶/static/src/js/m2m_group_model.jsï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

   ```
   odoo.define('m2m_group.Model', function (require) {
     'use strict';
   
     var AbstractModel = require('web.AbstractModel');
   
     var M2mGroupModel = AbstractModel.extend({
       get: function () {
         return this.data;
       },
       load: function (params) {
         this.modelName = params.modelName;
         this.domain = params.domain;
         this.m2m_field = params.m2m_field;
         return this._fetchData();
       },
       reload: function (handle, params) {
         if ('domain' in params) {
           this.domain = params.domain;
         }
         return this._fetchData();
       },
       _fetchData: function () {
         var self = this;
         return this._rpc({
           model: this.modelName,
           method: 'get_m2m_group_data',
           kwargs: {
             domain: this.domain,
             m2m_field: this.m2m_field
           }
         }).then(function (result) {
           self.data = result;
         });
       },
     });
   
     return M2mGroupModel;
   
   });
   ```

5. æ–°å¢æ–‡ä»¶/static/src/js/m2m_group_controller.jsï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

   ```
   odoo.define('m2m_group.Controller', function (require) {
     'use strict';
   
     var AbstractController = require('web.AbstractController');
     var core = require('web.core');
     var qweb = core.qweb;
     
     var M2mGroupController = AbstractController.extend({
       custom_events: _.extend({},
       AbstractController.prototype.custom_events, {
         'btn_clicked': '_onBtnClicked',
       }),
       renderButtons: function ($node) {
         if ($node) {
           this.$buttons =
           $(qweb.render('ViewM2mGroup.buttons'));
           this.$buttons.appendTo($node);
           this.$buttons.on('click', 'button',
           this._onAddButtonClick.bind(this));
         }
       },
       _onBtnClicked: function (ev) {
         this.do_action({
           type: 'ir.actions.act_window',
           name: this.title,
           res_model: this.modelName,
           views: [[false, 'list'], [false, 'form']],
           domain: ev.data.domain,
         });
       },
       _onAddButtonClick: function (ev) {
         this.do_action({
           type: 'ir.actions.act_window',
           name: this.title,
           res_model: this.modelName,
           views: [[false, 'form']],
           target: 'new'
         });
       },
     
     });
   
     return M2mGroupController;
   
   });
   ```

6. æ–°å¢æ–‡ä»¶/static/src/js/m2m_group_renderer.jsï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

   ```
   odoo.define('m2m_group.Renderer', function (require) {
     'use strict';
   
     var AbstractRenderer = require('web.AbstractRenderer');
     var core = require('web.core');
   
     var qweb = core.qweb;
     
     var M2mGroupRenderer = AbstractRenderer.extend({
       events: _.extend({},
       AbstractRenderer.prototype.events, {
         'click .o_primay_button': '_onClickButton',
       }),
       _render: function () {
         var self = this;
         this.$el.empty();
         this.$el.append(qweb.render('ViewM2mGroup', {
           'groups': this.state,
         }));
         return this._super.apply(this, arguments);
       },
       _onClickButton: function (ev) {
         ev.preventDefault();
         var target = $(ev.currentTarget);
         var group_id = target.data('group');
         var children_ids =
         _.map(this.state[group_id].children, function (group_id) {
           return group_id.id;
         });
         this.trigger_up('btn_clicked', {
           'domain': [['id', 'in', children_ids]]
         });
       }
     });
   
     return M2mGroupRenderer;
   
   });
   ```

7. æ–°å¢æ–‡ä»¶/static/src/js/m2m_group_view.jsï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

   ```
   odoo.define('m2m_group.View', function (require) {
     'use strict';
   
     var AbstractView = require('web.AbstractView');
     var view_registry = require('web.view_registry');
     var M2mGroupController = require('m2m_group.Controller');
     var M2mGroupModel = require('m2m_group.Model');
     var M2mGroupRenderer = require('m2m_group.Renderer');
   
     var M2mGroupView = AbstractView.extend({
       display_name: 'Author',
       icon: 'fa-id-card-o',
       config: {
         Model: M2mGroupModel,
         Controller: M2mGroupController,
         Renderer: M2mGroupRenderer,
       },
       viewType: 'm2m_group',
       groupable: false,
       init: function (viewInfo, params) {
         this._super.apply(this, arguments);
         var attrs = this.arch.attrs;
         
         if (!attrs.m2m_field) {
           throw new Error('M2m view has not defined
           "m2m_field" attribute.');
         }
   
         // Model Parameters
         this.loadParams.m2m_field = attrs.m2m_field;
       },
     });
   
     view_registry.add('m2m_group', M2mGroupView);
   
     return M2mGroupView;
    });
   ```

8. åœ¨/static/src/xml/qweb_template.xmlæ–‡ä»¶ä¸­ä¸ºè§†å›¾æ·»åŠ QWebæ¨¡æ¿ï¼š

   ```
   <t t-name="ViewM2mGroup">
     <div class="row ml16 mr16">
       <div t-foreach="groups" t-as="group" class="col-3">
         <t t-set="group_data" t-value="groups[group]" />
         <div class="card mt16">
           <img class="card-img-top" t-attfsrc="/web/image/#{group_data.model}/#{group}/image"/>
           <div class="card-body">
             <h5 class="card-title mt8"><t tesc="group_data['name']"/></h5>
           </div>
           <ul class="list-group list-group-flush">
             <t t-foreach="group_data['children']" tas="child">
               <li class="list-group-item"><i class="fa fa-book"/> <t t-esc="child.name"/></li>
             </t>
           </ul>
           <div class="card-body">
             <a href="#" class="btn btn-sm btn-primary o_primay_button" t-att-data-group="group">View books</a>
           </div>
         </div>
       </div>
     </div>
   </t>
   <div t-name="ViewM2mGroup.buttons">
     <button type="button" class="btn btn-primary">
       Add Record
     </button>
   </div>
   ```

9. å‘åå°èµ„æºä¸­æ·»åŠ æ‰€æœ‰çš„JavaScriptæ–‡ä»¶ï¼š

   ```
   ...
   <script type="text/javascript" src="/my_library/static/src/js/m2m_group_view.js" />
   <script type="text/javascript" src="/my_library/static/src/js/m2m_group_model.js" />
   <script type="text/javascript" src="/my_library/static/src/js/m2m_group_controller.js" />
   <script type="text/javascript" src="/my_library/static/src/js/m2m_group_renderer.js" />
   ...
   ```

10. æœ€åï¼Œä¸ºlibrary.bookæ¨¡å‹æ·»åŠ æˆ‘ä»¬çš„æ–°è§†å›¾ï¼š

    ```
    <record id="library_book_view_author" model="ir.ui.view">
      <field name="name">Library Book Author</field>
      <field name="model">library.book</field>
      <field name="arch" type="xml">
        <m2m_group m2m_field="author_ids" color_field="color">
        </m2m_group>
      </field>
     </record>
    ```

11. åœ¨å›¾ä¹¦åŠ¨ä½œä¸­æ·»åŠ m2m_groupï¼š

    ```
    ...
    <field name="view_mode">tree,m2m_group,form</field>
    ...
    ```

æ›´æ–°my_libraryæ¨¡å—ä»¥æ‰“å¼€å›¾ä¹¦è§†å›¾ï¼Œç„¶åï¼Œé€šè¿‡è§†å›¾åˆ‡æ¢å›¾æ ‡ï¼Œæ‰“å¼€æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„çš„æ–°è§†å›¾ã€‚ä¼šé•¿æˆä¸‹é¢è¿™æ ·ï¼š

![å›¾15.3 â€“ Many2manyåˆ†ç»„è§†å›¾](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/202105291412556.png)

å›¾15.3 â€“ Many2manyåˆ†ç»„è§†å›¾

> ğŸ“**é‡è¦ä¿¡æ¯**ï¼šOdooè§†å›¾éå¸¸æ˜“äºä½¿ç”¨ä¹Ÿå¾ˆçµæ´»ã€‚ä½†æ˜¯ï¼Œé€šå¸¸å®¹æ˜“å’Œçµæ´»çš„äº‹ç‰©èƒŒåéƒ½æ˜¯å¤æ‚çš„å®ç°ã€‚å¯¹äºOdooçš„JavaScriptè§†å›¾æ­£æ˜¯å¦‚æ­¤ï¼šå¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œä½†å®ç°å¾ˆå¤æ‚ã€‚å®ƒåŒ…å«å¤§é‡çš„ç»„æˆéƒ¨åˆ†ï¼Œå¦‚æ¨¡å‹ã€æ¸²æŸ“å™¨ã€æ§åˆ¶å™¨ã€è§†å›¾ã€QWebæ¨¡æ¿ç­‰ç­‰ã€‚åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†æ‰€æœ‰è§†å›¾æ‰€éœ€çš„æ„ä»¶å¹¶ä½¿ç”¨äº†library.bookæ¨¡å‹ä¸­çš„æ–°è§†å›¾ã€‚å¦‚æœä¸æƒ³è¦æ‰‹åŠ¨åšæ‰€æœ‰çš„å·¥ä½œï¼Œå¯ä»æœ¬ä¹¦çš„GitHubä»“åº“ä¸­è·å–æ¨¡å—ç¤ºä¾‹æ–‡ä»¶ã€‚

### å®ç°åŸç†...

ç¬¬1å’Œç¬¬2æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨ ir.ui.viewå’Œir.actions.act_window.viewä¸­æ³¨å†Œäº†ä¸€ä¸ªæ–°è§†å›¾ç±»å‹ï¼Œåä¸ºm2m_groupã€‚

ç¬¬3æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨baseä¸­æ·»åŠ äº†get_m2m_group_dataæ–¹æ³•ã€‚åœ¨baseä¸­æ·»åŠ è¯¥æ–¹æ³•ä¼šè®©å…¶åœ¨æ‰€æœ‰æ¨¡å‹ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨JavaScriptè§†å›¾ä¸­é€šè¿‡RPCè°ƒç”¨ã€‚è¯¥è§†å›¾ä¼ é€’ä¸¤ä¸ªå‚æ•° - domainå’Œm2m_fieldã€‚åœ¨domainå‚æ•°ä¸­ï¼Œdomainå€¼ä¼šæ˜¯ç”±æœç´¢è§†å›¾åŸŸå’ŒåŠ¨ä½œåŸŸæ‹¼æ¥æ‰€ç”Ÿæˆçš„ä½œç”¨åŸŸã€‚m2m_fieldæ˜¯æˆ‘ä»¬å¸Œæœ›å¯¹è®°å½•åˆ†ç»„çš„å­—æ®µåã€‚è¿™ä¸ªå­—æ®µåœ¨è§†å›¾å®šä¹‰ä¸­è¿›è¡Œè®¾ç½®ã€‚

åœ¨æ¥ä¸‹æ¥çš„å‡ æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†è¦æ±‚æ„æˆè§†å›¾çš„JavaScriptæ–‡ä»¶ã€‚Odooçš„JavaScriptè§†å›¾ç”±è§†å›¾ã€æ¨¡å‹ã€æ¸²æŸ“å™¨å’Œæ§åˆ¶å™¨ç»„æˆã€‚è§†å›¾åœ¨Odooçš„ä»£ç ä¸­æœ‰ä¸€äº›å†å²å«ä¹‰ï¼Œå› æ­¤åœ¨Odooä¸­æ¨¡å‹ã€è§†å›¾ã€æ§åˆ¶å™¨ï¼ˆMVCï¼‰å˜æˆäº†æ¨¡å‹ã€æ¸²æŸ“å™¨å’Œæ§åˆ¶å™¨ï¼ˆMRCï¼‰ã€‚æ€»çš„æ¥è¯´ï¼Œè§†å›¾è®¾ç½®æ¨¡å‹ã€æ¸²æŸ“å™¨å’Œæ§åˆ¶å™¨ï¼Œå¹¶è®¾ç½®MVCç­‰çº§æ¥å˜æˆä¸‹é¢è¿™æ ·ï¼š

[![Odoo çš„ MRC](https://alanhou.org/homepage/wp-content/uploads/2019/05/2019071608395358.png)]()

å›¾15.4 â€“ è§†å›¾ç»„ä»¶

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¨¡å‹ã€æ¸²æŸ“å™¨ã€æ§åˆ¶å™¨å’Œè§†å›¾çš„è§’è‰²ã€‚æ¨¡å‹ã€æ¸²æŸ“å™¨ã€æ§åˆ¶å™¨å’Œè§†å›¾çš„æŠ½è±¡ç‰ˆæœ¬æ‹¥æœ‰æ„æˆè§†å›¾æ‰€éœ€çš„æ‰€æœ‰åŸºç¡€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­é€šè¿‡ç»§æ‰¿å®ƒä»¬åˆ›å»ºäº†æ¨¡å‹ã€æ¸²æŸ“å™¨ã€æ§åˆ¶å™¨å’Œè§†å›¾ã€‚

è¿™é‡Œæœ‰ä¸€äº›ç”¨äºåˆ›å»ºè§†å›¾çš„ä¸åŒéƒ¨åˆ†çš„æ·±å…¥è®²è§£ï¼š

- Modelï¼šæ¨¡å‹çš„è§’è‰²æ˜¯å­˜æ”¾è§†å›¾çŠ¶æ€ã€‚å®ƒå‘æ•°æ®æœåŠ¡å™¨å‘é€RPCè¯·æ±‚ï¼Œç„¶åå‘æ§åˆ¶å™¨å’Œæ¸²æŸ“å™¨ä¼ é€’æ•°æ®ã€‚ç„¶åæˆ‘ä»¬é‡è½½__loadå’Œ__reloadæ–¹æ³•ã€‚åœ¨è§†å›¾åˆå§‹åŒ–æ—¶ï¼Œå®ƒè°ƒç”¨__load()æ–¹æ³•æ¥è·å–æ•°æ®ï¼Œåœ¨æœç´¢æ¡ä»¶ä¿®æ”¹äº†æˆ–è§†å›¾éœ€è¦æ–°çŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨__reload()æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†é€šç”¨çš„_fetchData()æ–¹æ³•æ¥åšRPCè°ƒç”¨è·å–æ•°æ®ã€‚æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº†åœ¨ç¬¬3æ­¥ä¸­æ·»åŠ çš„get_m2m_group_dataæ–¹æ³•ã€‚ä¼šä»æ§åˆ¶å™¨è°ƒç”¨__get()æ–¹æ³•æ¥è·å–æ¨¡å‹çš„çŠ¶æ€ã€‚

- Controllerï¼šæ§åˆ¶å™¨çš„è§’è‰²æ˜¯ç®¡ç†æ¨¡å‹å’Œæ¸²æŸ“å™¨ä¹‹é—´çš„è°ƒåº¦ã€åœ¨æ¸²æŸ“å™¨ä¸­å‘ç”ŸåŠ¨ä½œæ—¶ï¼Œå®ƒä¼ é€’è¯¥ä¿¡æ¯åˆ°æ§åˆ¶å™¨ä¸­å¹¶ç›¸åº”åœ°æ‰§è¡ŒåŠ¨ä½œã€‚æœ‰æ—¶ï¼Œå®ƒè¿˜ä¼šåœ¨æ¨¡å‹ä¸­è°ƒç”¨ä¸€äº›æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå®ƒç®¡ç†æ§åˆ¶é¢æ¿ä¸­çš„æŒ‰é’®ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°å¢è®°å½•çš„æŒ‰é’®ã€‚ä¸ºè¿›è¡Œå®ç°ï¼Œæˆ‘ä»¬é‡è½½äº†AbstractControllerçš„renderButtons() æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜æ³¨å†Œäº†custom_eventsï¼Œè¿™æ ·åœ¨ç‚¹å‡»äº†ä½œè€…å¡ç‰‡ä¸­çš„æŒ‰é’®æ—¶ï¼Œæ¸²æŸ“å™¨ä¼šè§¦å‘æ§åˆ¶å™¨çš„äº‹ä»¶æ¥è®©å…¶æ‰§è¡ŒåŠ¨ä½œã€‚

- Rendererï¼šæ¸²æŸ“å™¨çš„è§’è‰²æ˜¯ç®¡ç†è§†å›¾çš„DOMå…ƒç´ ã€‚æ¯ä¸ªè§†å›¾å¯ä»¥æŒ‰ä¸åŒçš„æ–¹å¼æ¸²æŸ“æ•°æ®ã€‚åœ¨æ¸²æŸ“å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å˜é‡stateä¸­è·å–æ¨¡å‹çš„çŠ¶æ€ã€‚å®ƒè°ƒç”¨è¿›è¡Œæ¸²æŸ“çš„render() æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ˜¾ç¤ºè§†å›¾çš„å½“å‰çŠ¶æ€æ¸²æŸ“äº†ViewM2mGroup QWebæ¨¡æ¿ã€‚æˆ‘ä»¬è¿˜å°†JavaScriptçš„äº‹ä»¶æ˜ å°„åˆ°äº†ç”¨æˆ·çš„åŠ¨ä½œã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬è¿˜ç»‘å®šäº†å¡ç‰‡ä¸­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚åœ¨ç‚¹å‡»ä½œè€…å¡ç‰‡æŒ‰é’®æ—¶ï¼Œå®ƒä¼šè§¦å‘btn_clickedäº‹ä»¶ç»™æ§åˆ¶å™¨ï¼Œå¹¶ä¸”ä¼šæ‰“å¼€è¯¥ä½œè€…æ˜¯çš„å›¾ä¹¦åˆ—è¡¨ã€‚

  > ğŸ“**é‡è¦ä¿¡æ¯**ï¼šæ³¨æ„äº‹ä»¶å’Œcustom_eventsæ˜¯ä¸åŒçš„ã€‚äº‹ä»¶æ˜¯å¸¸è§„çš„JavaScriptäº‹ä»¶ï¼Œè€Œcustom_eventsäº‹ä»¶æ¥è‡ªOdooçš„JavaScriptæ¡†æ¶ã€‚è‡ªå®šä¹‰äº‹ä»¶å¯ä»¥ç”±trigger_upæ–¹æ³•è°ƒç”¨ã€‚

- Viewï¼šè§†å›¾çš„è§’è‰²æ˜¯è·å–æ‰€æœ‰è¦æ±‚æ„å»ºè§†å›¾çš„åŸºæœ¬å†…å®¹ï¼Œå¦‚ä¸€ç»„å­—æ®µã€ä¸Šä¸‹æ–‡ã€è§†å›¾ç»“æ„å’Œä¸€äº›å…¶å®ƒå‚æ•°ã€‚ç„¶åï¼Œè§†å›¾ä¼šåˆå§‹åŒ–æ§åˆ¶å™¨ã€æ¸²æŸ“å™¨å’Œæ¨¡å‹ä¸‰å‰‘å®¢ã€‚å®ƒä¼šåœ¨MVCç­‰çº§ä¸­è¿›è¡Œè®¾ç½®ã€‚é€šå¸¸ï¼Œå®ƒè®¾ç½®æ¨¡å‹ã€è§†å›¾å’Œæ§åˆ¶å™¨æ‰€éœ€è¦çš„å‚æ•°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦m2m_fieldåç§°æ¥è·å–æ¨¡å‹ä¸­é€‚å½“çš„åˆ†ç»„æ•°æ®ï¼Œå› æ­¤åœ¨å…¶ä¸­è®¾ç½®äº†æ¨¡å‹å‚æ•°ã€‚ä»¥åŒæ ·çš„æ–¹å¼ï¼Œthis.controllerParamså’Œthis.rendererParamså¯ç”¨äºè®¾ç½®æ§åˆ¶å™¨å’Œæ¸²æŸ“å™¨ä¸­çš„å‚æ•°ã€‚

ç¬¬8æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†è§†å›¾å’Œæ§åˆ¶é¢æ¿æŒ‰é’®çš„QWebæ¨¡æ¿ã€‚è¦äº†è§£æœ‰å…³QWebæ¨¡æ¿æ›´å¤šçš„çŸ¥è¯†ï¼Œè¯·å‚è§æœ¬ç« ä¸­çš„*ä½¿ç”¨å®¢æˆ·ç«¯QWebæ¨¡æ¿*ä¸€èŠ‚ã€‚

> **ğŸ“é‡è¦ä¿¡æ¯ï¼š**Odooè§†å›¾æœ‰å¤§é‡ä¸åŒç”¨é€”çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨æœ¬èŠ‚ä¸­å­¦ä¹ äº†ä¸€äº›æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å¦‚æœæƒ³è¦æ›´æ·±å…¥åœ°å­¦ä¹ è§†å›¾ï¼Œå¯ä»¥è¿›å…¥/addons/web/static/src/js/views/ç›®å½•åšæ›´è¿›ä¸€æ­¥çš„æ¢ç´¢ã€‚è¯¥ç›®å½•è¿˜åŒ…å«æŠ½è±¡æ¨¡å‹ã€æ§åˆ¶å™¨ã€æ¸²æŸ“å™¨å’Œè§†å›¾çš„ä»£ç ã€‚

ç¬¬9æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨èµ„æºä¸­æ·»åŠ äº†JavaScriptæ–‡ä»¶ã€‚

åœ¨æœ€åçš„ä¸¤æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†é’ˆå¯¹library.bookæ¨¡å‹çš„è§†å›¾å®šä¹‰ã€‚ç¬¬10æ­¥ä¸­ï¼Œæˆ‘ä»¬å¯¹è§†å›¾ä½¿ç”¨äº†<m2m_group>æ ‡ç­¾ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜ä¼ é€’äº†m2m_fieldå±æ€§æ¥ä½œä¸ºä¸€ä¸ªé€‰é¡¹ã€‚å®ƒä¼šä¼ é€’ç»™æ¨¡å‹æ¥ä»æœåŠ¡ç«¯è·å–æ•°æ®ã€‚

### æ‰©å±•çŸ¥è¯†...

å¦‚æœä½ ä¸æƒ³è¦å¼•å…¥æ–°è§†å›¾ç±»å‹ï¼Œè€Œåªæ˜¯æƒ³è¦åœ¨è§†å›¾ä¸­ä¿®æ”¹ä¸€äº›å†…å®¹ï¼Œå¯ä»¥åœ¨è§†å›¾ä¸­ä½¿ç”¨js_classã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç±»ä¼¼æˆ‘ä»¬åˆ›å»ºçš„çœ‹æ¿çš„è§†å›¾ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·è¿›è¡Œç»§æ‰¿ï¼š

```
var CustomRenderer = KanbanRenderer.extend({
  ...
});

var CustomRendererModel = KanbanModel.extend({
  ...
});

var CustomRendererController = KanbanController.extend({
  ...
});

var CustomDashboardView = KanbanView.extend({
  config: _.extend({}, KanbanView.prototype.config, {
    Model: CustomDashboardModel,
    Renderer: CustomDashboardRenderer,
    Controller: CustomDashboardController,
  }),
});

var viewRegistry = require('web.view_registry');
viewRegistry.add('my_custom_view', CustomDashboardView);
```

ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡js_classä½¿ç”¨çœ‹æ¿è§†å›¾ï¼ˆæ³¨æ„æœåŠ¡ç«¯ä»ä¼šå°†å…¶çœ‹ä½œä¸€ä¸ªçœ‹æ¿è§†å›¾ï¼‰ï¼š

```
...
<field name="arch" type="xml">
  <kanban js_class="my_custom_view">
    ...
  </kanban>
</field>
...
```

## è°ƒè¯•å®¢æˆ·ç«¯ä»£ç 

å…³äºè°ƒè¯•æœåŠ¡ç«¯çš„ä»£ç ï¼Œæœ¬ä¹¦ä¸­æœ‰å•ç‹¬çš„ä¸€æ•´ç« [ç¬¬ä¸ƒç«  è°ƒè¯•æ¨¡å—](7.md)è¿›è¡Œè®²è§£ã€‚è€Œå¯¹äºå®¢æˆ·ç«¯ï¼Œæœ¬èŠ‚ä¼šåšä¸€äº›åˆæ­¥è®²è§£ã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬èŠ‚å¹¶ä¸ä¾èµ–äºå…·ä½“çš„ä»£ç ï¼Œä½†å¦‚æœä½ å¸Œæœ›èƒ½å¤Ÿé‡ç°å…¶ä¸­çš„å†…å®¹ï¼Œè¯·ä½¿ç”¨å‰ä¸€å°èŠ‚ä¸­çš„ä»£ç ã€‚

### å¦‚ä½•å®ç°...

å®¢æˆ·ç«¯è„šæœ¬è°ƒè¯•å›°éš¾çš„åŸå› åœ¨äºç½‘é¡µå®¢æˆ·ç«¯é‡åº¦ä¾èµ–äºjQueryçš„å¼‚æ­¥äº‹ä»¶ã€‚æ—¢ç„¶æ–­ç‚¹ä¼šä¸­æ–­æ‰§è¡Œï¼Œåœ¨è°ƒè¯•æ—¶ç”±å®šæ—¶é—®é¢˜ä¼šå¼•èµ·çš„bugå¾ˆå¤§æœºç‡ä¸ä¼šå‘ç”Ÿã€‚ç¨åæˆ‘ä»¬ä¼šè®¨è®ºä¸€äº›ç­–ç•¥ã€‚

1. å¯¹äºå®¢æˆ·ç«¯è°ƒè¯•ï¼Œæˆ‘ä»¬éœ€è¦æ¿€æ´»å¸¦èµ„æºçš„è°ƒè¯•æ¨¡å¼ã€‚å¦‚æœä¸çŸ¥é“å¦‚ä½•å¯ç”¨å¸¦èµ„æºçš„è°ƒè¯•æ¨¡å¼ï¼Œè¯·å‚è§[ç¬¬ä¸€ç«  å®‰è£…Odooå¼€å‘ç¯å¢ƒ](1.md)ä¸­çš„*å¯ç”¨Odooå¼€å‘è€…å·¥å…·*ä¸€èŠ‚ã€‚

2. åœ¨éœ€è¦è°ƒè¯•çš„JavaScriptå‡½æ•°ä¸­è°ƒç”¨è°ƒè¯•å™¨ï¼š

   ```
   debugger;
   ```

3. å¦‚æœå­˜åœ¨å®šæ—¶é—®é¢˜ï¼Œé€šè¿‡JavaScriptå‡½æ•°åœ¨æ§åˆ¶å°æ‰“å°è®°å½•ï¼š

   ```
   console.log("I'm in function X currently");
   ```

4. å¦‚æœå¸Œæœ›åœ¨æ¨¡æ¿æ¸²æŸ“æ—¶è¿›è¡Œè°ƒè¯•ï¼Œåœ¨QWebä¸­è°ƒç”¨è°ƒè¯•å™¨ï¼š

   ```
   <t t-debug="" />
   ```

5. ä¹Ÿå¯ä»¥è®©QWebåœ¨æ§åˆ¶å°ä¸­æ‰“å°è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```
   <t t-log="myvalue" />
   ```

æ‰€æœ‰è¿™äº›ä¾èµ–äºæµè§ˆå™¨ä¸ºè°ƒè¯•æä¾›é€‚å½“çš„åŠŸèƒ½ã€‚è€Œæ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æœ‰ç›¸å…³æ”¯æŒï¼Œè¿™é‡Œæˆ‘ä»¬ä»…ä½¿ç”¨Chromiumæ¥ä½œä¸ºæ¼”ç¤ºã€‚è¦ä½¿ç”¨è°ƒè¯•å·¥å…·ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’èœå•æŒ‰é’®å¹¶é€‰æ‹©More tools > Developer toolsï¼ˆè¯‘è€…æ³¨ï¼šé€šå¸¸å¯é€šè¿‡å³å‡»>æ£€æŸ¥å…ƒç´ æˆ–å¿«æ·é”®F12/Fn+F12è¿›è¡Œè°ƒå–ï¼‰ï¼š

![å›¾15.5 â€“ åœ¨Chromeä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021052915045247.jpg)

å›¾15.5 â€“ åœ¨Chromeä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·

### å®ç°åŸç†...

æ‰“å¼€è°ƒè¯•å™¨æ—¶ï¼Œåº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹å›¾çš„å†…å®¹ï¼š

![å›¾15.6 â€“ æš‚åœçŠ¶æ€çš„è°ƒè¯•å™¨](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021052915064934.png)

å›¾15.6 â€“ æš‚åœçŠ¶æ€çš„è°ƒè¯•å™¨

è¿™é‡Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„æ ‡ç­¾é¡µä¸Šè®¿é—®å¤§é‡çš„å·¥å…·ã€‚ä¸‹å›¾ä¸­å½“å‰å¼€å¯çš„æ ‡ç­¾ä¸ºJavaScriptè°ƒè¯•å™¨ï¼Œæˆ‘ä»¬é€šè¿‡ç‚¹å‡»è¡Œå·åœ¨ç¬¬31è¡Œè®¾ç½®äº†æ–­ç‚¹ã€‚æ¯æ¬¡æˆ‘ä»¬çš„å¾®ä»¶è·å–ç”¨æˆ·åˆ—è¡¨æ—¶ï¼Œæ‰§è¡Œä¼šåœæ­¢åœ¨è¿™ä¸€è¡Œï¼Œè°ƒè¯•å™¨è®©æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å˜é‡æˆ–ä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚åœ¨å³ä¾§çš„æŸ¥çœ‹åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨å‡½æ•°æ¥æµ‹è¯•å®ƒä»¬çš„æ•ˆæœè€Œæ— éœ€æŒç»­ä¿å­˜è„šæœ¬æ–‡ä»¶å¹¶é‡æ–°åŠ è½½é¡µé¢ã€‚

![ç¬¬31è¡Œæ–­ç‚¹è°ƒè¯•](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021052915154958.png)

æˆ‘ä»¬å‰é¢æ‰€æåˆ°çš„debuggerè¯­å¥åœ¨æ‰“å¼€å¼€å‘è€…å·¥å…·æ—¶ä¼šè¿›è¡ŒåŒæ ·çš„ä¸­æ–­ã€‚æ‰§è¡Œä¼šåœæ­¢ï¼Œè€Œæµè§ˆå™¨ä¼šåˆ‡æ¢åˆ°Sourcesæ ‡ç­¾ï¼Œæ‰“å¼€æ‰€è°ƒè¯•çš„æ–‡ä»¶å¹¶åœ¨æœ‰debuggerçš„é‚£ä¸€è¡Œé«˜äº®æ˜¾ç¤ºã€‚

å‰é¢å¯èƒ½ä¼šæ‰“å°æ—¥å¿—çš„ä¸¤å¤„ä¼šå‡ºç°åœ¨Consoleæ ‡ç­¾ä¸­ã€‚åœ¨é‡åˆ°é—®é¢˜æ—¶è¿™åº”è¯¥æ˜¯ç¬¬ä¸€ä¸ªè¦å»æŸ¥çœ‹çš„æ ‡ç­¾ï¼Œå› ä¸ºå¦‚æœJavaScriptå› è¯­æ³•é”™è¯¯è€Œå®Œå…¨æ²¡æœ‰åŠ è½½æˆ–æ˜¯ç±»ä¼¼çš„åŸºæœ¬é”™è¯¯ï¼Œéƒ½ä¼šåœ¨è¿™ä¸ªæ ‡ç­¾ä¸­çœ‹åˆ°è¯´æ˜æƒ…å†µçš„é”™è¯¯ä¿¡æ¯ã€‚

### æ‰©å±•çŸ¥è¯†...

ä½¿ç”¨Elementsæ ‡ç­¾æ¥æŸ¥çœ‹æµè§ˆå™¨å½“å‰æ˜¾ç¤ºé¡µé¢çš„DOMç»“æ„ã€‚åœ¨å¯¹äºç†Ÿæ‚‰å·²æœ‰å¾®ä»¶ç”Ÿæˆçš„HTMLä»£ç éå¸¸æœ‰å¸®åŠ©ï¼Œå¹¶ä¸”å®ƒé€šå¸¸è¿˜è®©æˆ‘ä»¬å¯ä»¥è°ƒæ•´ç±»å’ŒCSSå±æ€§ã€‚å¯¹äºæµ‹è¯•å¸ƒå±€è°ƒæ•´éå¸¸æœ‰å¸®åŠ©ã€‚

Networkæ ‡ç­¾ç»™å‡ºå¯¹å½“å‰é¡µé¢è¯·æ±‚åŠæ—¶é•¿çš„æ€»è§ˆã€‚è¿™å¯¹äºè°ƒè¯•åŠ è½½é€Ÿåº¦æ…¢çš„é¡µé¢å¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºåœ¨Networkæ ‡ç­¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„è¯¦æƒ…ã€‚å¦‚æœé€‰æ‹©ä¸€ä¸ªå…·ä½“çš„è¯·æ±‚ï¼Œå¯ä»¥æŸ¥çœ‹å…¶ä¼ é€’ç»™æœåŠ¡å™¨çš„è´Ÿè½½åŠè¿”å›çš„ç»“æœï¼Œæœ‰åŠ©äºåœ¨å®¢æˆ·ç«¯å¼„æ¸…æ¥šæ„æ–™å¤–è¡Œä¸ºäº§ç”Ÿçš„åŸå› ã€‚è¿˜ä¼šçœ‹åˆ°æ‰€åšè¯·æ±‚çš„çŠ¶æ€ç ï¼Œå¦‚å› æ‹¼é”™æ–‡ä»¶åè€Œæ‰¾ä¸åˆ°èµ„æºæ—¶æ˜¾ç¤º404ï¼Œ

## é€šè¿‡å¼•å¯¼æå‡ç”¨æˆ·ä¸Šæ‰‹ä½“éªŒ

åœ¨å¼€å‘å®Œå¤§åº”ç”¨ä¹‹åï¼Œå‘ç»ˆç«¯ç”¨æˆ·è¯´æ˜è½¯ä»¶æµç¨‹éå¸¸å…³é”®ã€‚Odooæ¡†æ¶åŒ…å«ä¸€ä¸ªå†…ç½®çš„å¯¼è§ˆç®¡ç†å™¨ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·é€šè¿‡äº†è§£å…·ä½“çš„æµç¨‹æ¥å¾—åˆ°æŒ‡å¯¼ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåœ¨å›¾ä¹¦é¦†ä¸­åˆ›å»ºå›¾ä¹¦çš„å¼•å¯¼ã€‚

### å‡†å¤‡å·¥ä½œ

æˆ‘ä»¬å°†ä½¿ç”¨å‰é¢å°èŠ‚çš„my_libraryæ¨¡å—ã€‚å¯¼è§ˆä»…åœ¨æ²¡æœ‰æ¼”ç¤ºæ•°æ®çš„æ•°æ®åº“ä¸­æ˜¾ç¤ºï¼Œå› æ­¤å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¸¦æœ‰demoæ•°æ®çš„æ•°æ®åº“ï¼Œè¯·ä¸ºæœ¬èŠ‚åˆ›å»ºä¸€ä¸ªæ²¡æœ‰æ¼”ç¤ºæ•°æ®çš„æ•°æ®åº“ã€‚

### å¦‚ä½•å®ç°...

æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤æ¥ä¸ºå›¾ä¹¦é¦†æ·»åŠ å¼•å¯¼ï¼š

1. æ–°å¢ä¸€ä¸ª/static/src/js/my_library_tour.jsæ–‡ä»¶å¹¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

   ```
   odoo.define('my_library.tour', function (require) {
     "use strict";
     var core = require('web.core');
     var tour = require('web_tour.tour');
     var _t = core._t;
       tour.register('library_tour', {
       url: "/web",
     }, [tour.STEPS.SHOW_APPS_MENU_ITEM, {
         trigger: '.o_app[data-menuxmlid="my_library.library_base_menu"]',
         content: _t('Manage books and authors in<b>Library app</b>.'),
         position: 'right'
       }, {
         trigger: '.o_list_button_add',
         content: _t("Let's create new book."),
         position: 'bottom'
       }, {
         trigger: 'input[name="name"]',
         extra_trigger: '.o_form_editable',
         content: _t('Set the book title'),
         position: 'right',
       }, {
         trigger: '.o_form_button_save',
         content: _t('Save this book record'),
         position: 'bottom',
       }
     ]);
   });
   ```

2. åœ¨åå°èµ„æºä¸­æ·»åŠ å¯¼è§ˆJavaScriptæ–‡ä»¶ï¼š

   ```
   ...
   <script type="text/javascript" src="/my_library/static/src/js/my_library_tour.js" />
   ...
   ```

æ›´æ–°è¯¥æ¨¡å—å¹¶æ‰“å¼€Odooåå°ã€‚æ­¤æ—¶å°±ä¼šçœ‹åˆ°ä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„å¼•å¯¼ï¼š

![å›¾15.7 â€“ æ–°æ‰‹ç”¨æˆ·çš„å¼•å¯¼æ­¥éª¤](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/202105291550393.png)

å›¾15.7 â€“ æ–°æ‰‹ç”¨æˆ·çš„å¼•å¯¼æ­¥éª¤

è¯·ç¡®ä¿åœ¨Odooå®ä¾‹ä¸­ç¦ç”¨äº†æ¼”ç¤ºæ•°æ®ã€‚å¸¦æœ‰æ¼”ç¤ºæ•°æ®çš„å®ä¾‹ä¸ä¼šæ˜¾ç¤ºå¯¼è§ˆã€‚

**è¯‘è€…æ³¨**ï¼šå‘½ä»¤è¡Œå®‰è£…å¯ä½¿ç”¨`--without-demo=all -i base,my_library`æ¥ä¸å®‰è£…æ¼”ç¤ºæ•°æ®å¹¶ä¸”è‡ªåŠ¨å®‰è£…å›¾ä¹¦åº”ç”¨

### å®ç°åŸç†...

å¼•å¯¼ç®¡ç†å™¨åœ¨web_tour.tourå‘½åç©ºé—´ä¸‹ã€‚

ç¬¬1æ­¥ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†web_tour.tourã€‚ç„¶åå°±å¯ä»¥é€šè¿‡register()å‡½æ•°æ–°å¢å¼•å¯¼äº†ã€‚æˆ‘ä»¬é€šè¿‡library_touråç§°æ³¨å†Œäº†å¯¼è§ˆå¹¶ä¼ é€’äº†è¿è¡Œå¯¼è§ˆçš„URLã€‚

ä¸‹ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¼è§ˆæ­¥éª¤çš„åˆ—è¡¨ã€‚æ¯ä¸ªå¯¼è§ˆæ­¥éª¤éœ€è¦3ä¸ªå€¼ã€‚triggerç”¨äºé€‰æ‹©å¼•å¯¼æ˜¾ç¤ºåœ¨å“ªä¸ªå…ƒç´ ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªJavaScripté€‰æ‹©å™¨ã€‚æˆ‘ä»¬ä½¿ç”¨äº†èœå•çš„XML IDï¼Œ å› ä¸ºå®ƒå­˜åœ¨äºDOMä¸­ã€‚

ç¬¬1æ­¥**tour.stepUtils.showAppsMenuItem()**æ˜¯ä¸ºä¸»èœå•é¢„å®šä¹‰çš„å¯¼è§ˆæ­¥éª¤ã€‚ä¸‹ä¸€ä¸ªé”®æ˜¯contentï¼Œåœ¨ç”¨æˆ·é¼ æ ‡æ‚¬åœåœ¨å¼•å¯¼æ°´æ»´å›¾æ ‡ä¸Šæ—¶æ˜¾ç¤ºè¯¥å†…å®¹ã€‚æˆ‘ä»¬ä½¿ç”¨äº†_t()å‡½æ•°ï¼Œå› ä¸ºå¸Œæœ›ç¿»è¯‘è¯¥å­—ç¬¦ä¸²ï¼Œè€Œpositioné”®ç”¨äºå†³å®šå¼•å¯¼å›¾æ ‡çš„ä½ç½®ã€‚å¯ä»¥é€‰æ‹©çš„å€¼æœ‰top, right, leftå’Œbottomã€‚

> ğŸ“**é‡è¦ä¿¡æ¯**ï¼šå¼•å¯¼ä¼šæå‡ç”¨äºä½¿ç”¨ä½“éªŒä»¥åŠå¯¹é›†æˆæµ‹è¯•çš„ç®¡ç†ã€‚åœ¨å†…éƒ¨ä»¥æµ‹è¯•æ¨¡å¼è¿è¡ŒOdooæ—¶ï¼Œä¹Ÿä¼šè¿è¡Œå¼•å¯¼å¹¶åœ¨å¯¼è§ˆæœªèƒ½å®Œæˆæ—¶å¼•å‘æµ‹è¯•ç”¨ä¾‹å¤±è´¥ã€‚

## ç§»åŠ¨åº”ç”¨JavaScriptï¼ˆä¼ä¸šç‰ˆï¼‰

Odoo 10å¼•å…¥äº†Odooç§»åŠ¨åº”ç”¨ã€‚å®ƒæä¾›æ‰§è¡Œç§»åŠ¨ç«¯åŠ¨ä½œçš„å°å·¥å…·ï¼Œå¦‚éœ‡åŠ¨æ‰‹æœºã€æ˜¾ç¤ºtoastå¼¹å‡ºæ¶ˆæ¯ã€æ‰«æäºŒç»´ç ç­‰ç­‰ã€‚

### å‡†å¤‡å·¥ä½œ

æˆ‘ä»¬å°†ä½¿ç”¨å‰ä¸€èŠ‚çš„my_libraryæ¨¡å—ã€‚æˆ‘ä»¬å°†é€šè¿‡ç§»åŠ¨åº”ç”¨åœ¨ä¿®æ”¹äº†**color**å­—æ®µå€¼æ—¶æ˜¾ç¤ºtoastæ¶ˆæ¯ã€‚

> âš ï¸è­¦å‘Šï¼šOdooç§»åŠ¨åº”ç”¨ä»…æ”¯æŒä¼ä¸šç‰ˆï¼Œå› æ­¤å¦‚æœä½ æ²¡æœ‰ä¼ä¸šç‰ˆï¼Œåˆ™æ— æ³•è¿›è¡Œæµ‹è¯•ã€‚

### å¦‚ä½•å®ç°...

æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤æ¥åœ¨Odooç§»åŠ¨åº”ç”¨ä¸­æ˜¾ç¤ºå¼¹å‡ºæ¶ˆæ¯ï¼š

1. åœ¨field_widget.jsä¸­å¯¼å…¥web_mobile.rpcï¼š

   ```
   var mobile = require('web_mobile.rpc');
   ```

2. ä¿®æ”¹clickPillæ–¹æ³•æ¥è®©ç”¨æˆ·åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¿®æ”¹é¢œè‰²æ—¶æ˜¾ç¤ºå¼¹å‡ºæ¶ˆæ¯:ï¼š

   ```
   clickPill: function (ev) {
       var $target = $(ev.currentTarget);
       var data = $target.data();
       this._setValue(data.val.toString());
       if (mobile.methods.showToast) {
           mobile.methods.showToast({'message': 'Color changed'});
       }
   }
   ```

å‡çº§æ¨¡å—å¹¶åœ¨ç§»åŠ¨åº”ç”¨ä¸­æ‰“å¼€library.bookæ¨¡å‹çš„è¡¨å•è§†å›¾ã€‚åœ¨ä¿®æ”¹é¢œè‰²æ—¶ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å¼¹å‡ºæ¶ˆæ¯ï¼š

![å›¾15.8 â€“ ä¿®æ”¹é¢œè‰²çš„Toastæ¶ˆæ¯](https://i.cdnl.ink/homepage/wp-content/uploads/2021/03/2021053000570893.png)

å›¾15.8 â€“ ä¿®æ”¹é¢œè‰²çš„Toastæ¶ˆæ¯

**è¯‘è€…æ³¨**ï¼šä¼ä¸šç‰ˆè‡ªå®šä¹‰æ¨¡å—éœ€åœ¨menu_itemä¸­æŒ‡å®šweb_iconæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºåº”ç”¨çš„å›¾æ ‡ã€‚

### å®ç°åŸç†...

web_mobile.rpcæä¾›äº†ç§»åŠ¨è®¾å¤‡ä¸Odoo JavaScriptä¹‹é—´çš„æ¡¥æ¢ã€‚å®ƒæš´éœ²ä¸€äº›åŸºæœ¬ç§»åŠ¨å·¥å…·ã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†showToastæ–¹æ³•æ¥åœ¨ç§»åŠ¨åº”ç”¨ä¸­æ˜¾ç¤ºå¼¹çª—ä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ£€æŸ¥è¯¥å‡½æ•°çš„å¯ç”¨æ€§ã€‚èƒŒåçš„åŸå› æ˜¯ä¸€äº›æ‰‹æœºå¯èƒ½ä¸æ”¯æŒæŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨è®¾å¤‡æ²¡æœ‰æ‘„åƒå¤´æ—¶ï¼Œå°±æ— æ³•ä½¿ç”¨scanBarcode()æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºé¿å…é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»£ç åŒ…è£¹åœ¨ if æ¡ä»¶ä¸­ã€‚

### æ‰©å±•çŸ¥è¯†...

Odooä¸­çš„ç§»åŠ¨ç«¯å·¥å…·æœ‰å¦‚ä¸‹è¿™äº›ï¼š

- showToast(): æ˜¾ç¤ºå¼¹å‡ºæ¶ˆæ¯
- vibrate(): æ‰‹æœºéœ‡åŠ¨
- showSnackBar(): æ˜¾ç¤ºå¸¦æœ‰æŒ‰é’®çš„æ»‘åŠ¨æ 
- showNotification(): æ˜¾ç¤ºæ‰‹æœºæç¤ºæ¶ˆæ¯
- addContact(): åœ¨ç”µè¯è–„ä¸­æ–°å¢è”ç³»äºº
- scanBarcode(): æ‰«æäºŒç»´ç 
- switchAccount(): åœ¨Androidä¸­æ‰“å¼€è´¦å·åˆ‡æ¢çª—å£

å­¦ä¹ æ›´å¤šæœ‰å…³ç§»åŠ¨ç«¯çš„JavaScriptçŸ¥è¯†ï¼Œè¯·å‚è§ï¼šhttps://www.odoo.com/documentation/14.0/developer/reference/mobile.htmlã€‚

 